function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),durations=[],GameDataClass=function(){function t(){_classCallCheck(this,t),this.list=[],this.start=null}return _createClass(t,[{key:"processAll",value:function(){var t=this;$(".status1").html("Waiting ..."),$(".table tr[data-name]").each(function(e,s){var n=$(s).attr("data-name");t.list.push(n)}),this.processAllAction()}},{key:"processAllAction",value:function(){var t=this;if(this.list.length>0){var e=this.list[0];return this.list.shift(),console.log("Processing:",e,"Remaining:",this.list.length),void this.processSingle(e,function(){t.processAllAction()})}console.log("Complete!")}},{key:"processSingle",value:function(t,e){var s=$("table tr.row-"+t);s.find(".status1").html('<i class="fa fa-circle-o-notch fa-spin"></i> Processing Game Files...');var n=s.position().top-400;$("body").scrollTop(n),$.ajax({url:"/gamedata/import/"+t+"/process",cache:!1,dataType:"json",method:"GET",success:function(t){t=t.length>0?t.join("<br>"):"Nothing to insert",s.find("td").addClass("highlight-success"),s.find(".status1").html('<i class="fa fa-check"></i> Complete!'),s.after('<tr><td colspan="5" class="import-log">'+t+"</td></tr>"),e&&e()},error:function(t,e,n){s.find("td").addClass("highlight-error"),s.find(".status1").html('<i class="fa fa-times"></i> Failed'),console.error(t,e,n)}})}},{key:"runLodestone",value:function(){var t=items;this.runLodestoneAction(t,t.length,[]),$(".ls-verify .progress").attr("value",0).text("0%")}},{key:"runLodestoneAction",value:function(t,e,s){var n=t[0];t.shift();var o=n.name_en.replace(" ","+"),a="https://localhost:3000/database/item/search?name="+o+"&c=1497705693&language=en",i=e-t.length;$(".ls-verify .setup-status").html('<i class="fa fa-circle-o-notch fa-spin"></i> ('+i+"/"+e+") "+n.id+" - "+n.name_en);+new Date;$.ajax({url:a,data:{count:t.length,total:e,lsid:n.lodestone_id},success:function(o){if(!o.error&&o.results[0]&&"undefined"!=typeof o.results[0].id){for(var a in o.results){var i=o.results[a];if(n.name_en.toLowerCase()==i.name.toLowerCase()){o=i;break}}return o?GameData.RunLodestoneActionDetails(o,n,t,e,s):(console.log("Failed on: "+n.id+" "+n.name),GameData.runLodestoneAction(t,e,s))}return console.log("Failed on: "+n.id+" "+n.name),GameData.runLodestoneAction(t,e,s)},error:function(t,e,s){$(".ls-verify .progress").attr("value",0).text("0%"),$(".ls-verify .setup-status").html("Error, check console"),console.error(e,s),console.log(t.responseText)}})}},{key:"RunLodestoneActionDetails",value:function(t,e,s,n,o){var a="https://localhost:3000/database/item/get/"+t.id;console.log("Doing detailed parse for: "+t.name),$.ajax({url:a,success:function(a){var i=a.icon.split(".png")[0];i=i.replace("https://img.finalfantasyxiv.com/lds/pc/global/images/itemicon/","");var l=$("#lodestone-results").val();return l+="UPDATE xiv_items SET lodestone_id = '"+t.id+"', icon_lodestone = '"+i+"', parsed_lodestone = 1, parsed_lodestone_time = NOW() WHERE id = "+e.id+";\n",$("#lodestone-results").val(l),o.push(e.id),console.log("Completed "+e.id),o.length<3e3?GameData.runLodestoneAction(s,n,o):void console.log("finished")},error:function(t){return console.log("Could not get item: "+e.id),GameData.runLodestoneAction(s,n,o)}})}},{key:"runConnections",value:function(){for(var t=[],e=0;e<size;e++)t.push(e);$(".dataconnections .progress").attr("value",0).text("0%"),$(".dataconnections .setup-status").html("Starting, "+t.length+" to process."),this.runConnectionsAction(t,t.length)}},{key:"runConnectionsAction",value:function(t,e){var s=t[0];t.shift();var n="/gamedata/gamesetup/connections/"+s,o=e-t.length,a=o/e*100;$.ajax({url:n,success:function(s){return s?($(".dataconnections .progress").attr("value",a).text(a+"%"),$(".dataconnections .setup-status").html('<i class="fa fa-circle-o-notch fa-spin"></i> Completed: ('+o+"/"+e+") "+s),t.length>0?void GameData.runConnectionsAction(t,e):void $(".dataconnections .setup-status").html('<i class="fa fa-check"></i> Completed! '+o+"/"+e)):(console.error("Unknown error?"),void console.log(s))},error:function(t,e,s){$(".dataconnections .progress").attr("value",0).text("0%"),$(".dataconnections .setup-status").html("Error, check console"),console.error(e,s),console.log(t.responseText)}})}}]),t}(),GameData=new GameDataClass,durations=[],LibraDataClass=function(){function t(){_classCallCheck(this,t),this.list=[],this.start=null}return _createClass(t,[{key:"processAll",value:function(){var t=this;$(".status1").html("Waiting ..."),$(".table tr[data-name]").each(function(e,s){var n=$(s).attr("data-name");t.list.push(n)}),this.processAllAction()}},{key:"processAllAction",value:function(){var t=this;if(this.list.length>0){var e=this.list[0];return this.list.shift(),console.log("Processing:",e,"Remaining:",this.list.length),void this.processSingle(e,function(){t.processAllAction()})}console.log("Complete!")}},{key:"processSingle",value:function(t,e){var s=$("table tr.row-"+t);s.find(".status1").html('<i class="fa fa-circle-o-notch fa-spin"></i> Processing Game Files...');var n=s.position().top-400;$("body").scrollTop(n),$.ajax({url:"/libra/import/"+t+"/process",cache:!1,dataType:"json",method:"GET",success:function(t){t=t.length>0?t.join("<br>"):"Nothing to insert",s.find("td").addClass("highlight-success"),s.find(".status1").html('<i class="fa fa-check"></i> Complete!'),s.after('<tr><td colspan="5" class="import-log">'+t+"</td></tr>"),e&&e()},error:function(t,e,n){s.find("td").addClass("highlight-error"),s.find(".status1").html('<i class="fa fa-times"></i> Failed'),console.error(t,e,n)}})}}]),t}(),LibraData=new LibraDataClass;