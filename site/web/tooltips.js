function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),XIVDBTooltipsClass=function(){function t(){_classCallCheck(this,t),this.version=1,this.tooltipsTimer=!1,this.tooltipsDelay=1e3,this.queueTimer=!1,this.queueDelay=500,this.onMobile=!1,this.startTimestamp=null}return _createClass(t,[{key:"init",value:function(){var t=this;this.startTimestamp=new Date,this.validateTooltipOptions(),XIVDBTooltipsDependency.pass(function(){t.onMobile=$(window).width()<=t.getOption("mobileMinimumWidth"),XIVDBTooltipsDOM.prepare(),t.get()})}},{key:"get",value:function(){var t=this;this.startTimestamp=new Date,clearTimeout(this.queue),this.queue=setTimeout(function(){XIVDBTooltipsLinks.detect();var e=XIVDBTooltipsLinks.links;e&&t.query(e,function(t){(CompletedEvent=XIVDBTooltips.getOption("event_tooltipsLoaded"))&&CompletedEvent(t),XIVDBTooltipsDOM.inject(t)})},this.queueDelay)}},{key:"query",value:function(t,e){var i={};t.each(function(t,e){var o=$(e).attr("data-xivdb-key"),n=$(e).attr("data-xivdb-isset"),s=o.split("_"),a=s[1].toString(),l=parseInt(s[2]);XIVDBTooltipsHolder.exists(o)&&n||0!=a.length&&l&&("undefined"==typeof i[a]&&(i[a]=[]),i[a].indexOf(l)==-1&&i[a].push(l))});for(var o in i)i[o]=i[o].join(",");Object.keys(i).length>0&&$.ajax({url:XIVDBTooltips.getOption("source")+"/tooltip?t="+Date.now(),method:"POST",dataType:"json",cache:!0,data:{list:i,language:this.getOption("language")},success:function(t){return t?"object"!=typeof t?void console.error("Tooltips response was not an object"):void(e&&e(t)):void console.error("Tooltips returned no response")},error:function(t,e,i){console.error("----------------"),console.error("Error loading tooltips!"),console.error(t.responseText),console.error(e,i),console.error("----------------")}})}},{key:"getDelayed",value:function(){clearTimeout(this.tooltipsTimer),this.tooltipsTimer=setTimeout(function(){XIVDBTooltips.get()},this.tooltipsDelay)}},{key:"hide",value:function(){XIVDBTooltipsDOM.hide()}},{key:"cachetime",value:function(){var t=new Date;return""+t.getFullYear()+t.getDate()}},{key:"setOptions",value:function(t){return this.options=t,window.location.href.indexOf(this.xivdb)>-1&&(this.options.includeCredits=!1),this}},{key:"getOption",value:function(t){return this.options[t]}},{key:"validateTooltipOptions",value:function(){for(var t in xivdb_tooltips_default)"undefined"==typeof this.options[t]&&(this.options[t]=xivdb_tooltips_default[t])}}]),t}(),XIVDBTooltipsDependencyClass=function(){function t(){_classCallCheck(this,t),this.jquery="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"}return _createClass(t,[{key:"pass",value:function(t){var e=this;return"undefined"!=typeof jQuery?t():void setTimeout(function(){"undefined"==typeof jQuery&&e.loadScript(e.jquery,function(){if(!e)var e=jQuery;return t()})},XIVDBTooltips.getOption("jqueryCheckDelay"))}},{key:"loadScript",value:function(t,e){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,e())}:i.onload=function(){e()},i.src=t,document.getElementsByTagName("head")[0].appendChild(i)}}]),t}(),XIVDBTooltipsDOMClass=function(){function t(){_classCallCheck(this,t),this.isActive=!1}return _createClass(t,[{key:"prepare",value:function(){var t=this,e=XIVDBTooltips.getOption("source"),i=XIVDBTooltips.cachetime();$("head").append('<link href="'+e+"/tooltips.css?v="+i+'" rel="stylesheet" type="text/css">'),XIVDBTooltips.onMobile||($("body").append('<div class="xivdb" style="display:none;"></div>'),$("html").on("mouseenter","[data-xivdb-key]",function(e){t.isActive=!0;var i=$(e.currentTarget),o=i.attr("data-xivdb-key"),n=XIVDBTooltipsHolder.get(o);$(".ui-draggable-dragging").length>0||($(".xivdb").html(n),t.show(e))}).on("mouseleave","*[data-xivdb-key]",function(e){t.isActive=!1;$(e.target);t.hide()}),$("html").on("mousemove",function(e){t.isActive&&t.follow(e)}),XIVDBTooltips.getOption("preventHtmlHeight")||$("html").css({height:"100%"}))}},{key:"inject",value:function(t){for(var e in t)for(var i in t[e]){var o=t[e][i];if(o){var n=o.data,s=o.html,a="xivdb_"+e+"_"+n.id,l=$('[data-xivdb-key="'+a+'"]');XIVDBTooltipsHolder.add(a,s);var r=l;if(r.attr("data-xivdb-isset",1),this.checkLinkSettings(r,["replace"])){if(this.checkLinkSettings(r,["seturlname","replacename"])&&r.text(n.name),this.checkLinkSettings(r,["seturlcolor","colorname"])){var c=XIVDBTooltips.getOption("seturlcolorDarken")?"rarity-"+n.color+"-darken":"rarity-"+n.color;r.addClass(c)}if(this.checkLinkSettings(r,["seturlicon","showicon"])){var c="xivdb-ii",p=parseInt($("a[data-xivdb-key]").css("font-size"),10)+4;n.icon.indexOf("finalfantasyxiv.com")==-1&&n.icon.indexOf("secure.xivdb")==-1&&(n.icon="https://secure.xivdb.com"+n.icon),r.prepend('<img src="'+n.icon+'" style="height:'+p+'px;" class="'+c+'">')}}}else console.log("false tooltip")}}},{key:"checkLinkSettings",value:function(t,e){for(var i in e){var o=e[i],n="data-xivdb-"+o;if(XIVDBTooltips.getOption(o)===!1)return!1;if(t.attr("data-xivdb-replace"))return!1;if("undefined"!=typeof t.attr(n)&&("0"==t.attr(n)||"false"==t.attr(n).toLowerCase()))return!1}return!0}},{key:"hide",value:function(){$(".xivdb").hide().html("")}},{key:"show",value:function(t){this.follow(t),$(".xivdb").show()}},{key:"follow",value:function(t){var e=t.pageX+XIVDBTooltips.getOption("tooltipDistanceX"),i=t.pageY+XIVDBTooltips.getOption("tooltipDistanceY"),o=$(".xivdb").outerWidth(!0),n=$(".xivdb").outerHeight(!0),s=i+n,a=e+o,l=$(window).height()+$(window).scrollTop(),r=$(window).scrollLeft()+$(window).width();a>r&&(e=t.pageX-(o+XIVDBTooltips.getOption("tooltipDistanceX"))),l<s&&(i=t.pageY-(n+XIVDBTooltips.getOption("tooltipDistanceY"))),this.position(e,i)}},{key:"position",value:function(t,e){$(".xivdb").css({top:e+"px",left:t+"px"})}}]),t}(),XIVDBTooltipsHolderClass=function(){function t(){_classCallCheck(this,t),this.tooltips={}}return _createClass(t,[{key:"add",value:function(t,e){this.tooltips[t]=e}},{key:"get",value:function(t){return this.tooltips[t]}},{key:"exists",value:function(t){return!!this.tooltips[t]}}]),t}(),XIVDBTooltipsLinksClass=function(){function t(){_classCallCheck(this,t),this.links=null}return _createClass(t,[{key:"detect",value:function(){XIVDBTooltips.getOption("linkContainer");$("a, *[data-tooltip-id]").each(function(t,e){var i=$(e),o=i.attr("href"),n=i.attr("data-tooltip-id"),s=!1,a=!1;if((n||!(i.attr("data-xivdb-ignore")||"undefined"==typeof o||o.length<1))&&!i.attr("data-xivdb-tooltip")&&(XIVDBTooltips.getOption("includeHiddenLinks")||i.is(":visible"))){if(n)n=n.split("/"),s=n[0],a=n[1];else{if(o=o.toString().toLowerCase().replace("http://","").replace("https://","").replace("//","/").replace("?","").toString(),"/"!=o[0]&&o.indexOf("xivdb.com")==-1)return;if(o=o.replace("fr.","").replace("de.","").replace("ja.","").replace("cns.","").replace("www.",""),o=o.replace("xivdb.com",""),o=o.split("/").filter(function(t){return t.toString().length>0}),xivdb_tooltips_valid_types.indexOf(o[0])==-1)return;if(s=o[0],a=o[1],"undefined"==typeof o||o.length<2)return}var l="xivdb_"+s+"_"+a;return i.attr("data-xivdb-parent")&&!i.attr("data-xivdb-key")?i.parents(i.attr("data-xivdb-parent")).attr("data-xivdb-key",l):i.attr("data-xivdb-parent")?void 0:i.attr("data-xivdb-key",l)}}),this.links=$("[data-xivdb-key]")}}]),t}(),xivdb_tooltips_default={source:"https://secure.xivdb.com",language:"en",replace:!0,seturlname:!0,seturlcolor:!0,seturlcolorDarken:!0,seturlicon:!0,includeHiddenLinks:!1,jqueryCheckDelay:500,mobileMinimumWidth:500,preventHtmlHeight:!1,tooltipDistanceX:20,tooltipDistanceY:20,event_tooltipsLoaded:null},xivdb_tooltips_valid_types=["item","achievement","action","gathering","instance","leve","enemy","emote","placename","status","title","recipe","quest","shop","npc","minion","mount","weather","fate"],XIVDBTooltips=new XIVDBTooltipsClass,XIVDBTooltipsDOM=new XIVDBTooltipsDOMClass,XIVDBTooltipsLinks=new XIVDBTooltipsLinksClass,XIVDBTooltipsHolder=new XIVDBTooltipsHolderClass,XIVDBTooltipsDependency=new XIVDBTooltipsDependencyClass;document.addEventListener("DOMContentLoaded",function(t){XIVDBTooltips.setOptions("undefined"!=typeof xivdb_tooltips?xivdb_tooltips:xivdb_tooltips_default).init()});